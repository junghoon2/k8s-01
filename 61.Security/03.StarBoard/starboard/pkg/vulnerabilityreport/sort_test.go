package vulnerabilityreport_test

import (
	"sort"
	"testing"

	"github.com/aquasecurity/starboard/pkg/apis/aquasecurity/v1alpha1"
	"github.com/aquasecurity/starboard/pkg/vulnerabilityreport"
	"github.com/stretchr/testify/assert"
)

func TestBySeverity(t *testing.T) {
	items := []v1alpha1.Vulnerability{
		{VulnerabilityID: "CVE-0000-0001", Severity: v1alpha1.SeverityLow},
		{VulnerabilityID: "CVE-0000-0002", Severity: v1alpha1.SeverityMedium},
		{VulnerabilityID: "CVE-0000-0003", Severity: v1alpha1.SeverityMedium},
		{VulnerabilityID: "CVE-0000-0004", Severity: v1alpha1.SeverityCritical},
		{VulnerabilityID: "CVE-0000-0005", Severity: v1alpha1.SeverityHigh},
		{VulnerabilityID: "CVE-0000-0006", Severity: v1alpha1.SeverityHigh},
	}

	sort.Stable(vulnerabilityreport.BySeverity{Vulnerabilities: items})

	assert.Equal(t, []v1alpha1.Vulnerability{
		{VulnerabilityID: "CVE-0000-0004", Severity: v1alpha1.SeverityCritical},
		{VulnerabilityID: "CVE-0000-0005", Severity: v1alpha1.SeverityHigh},
		{VulnerabilityID: "CVE-0000-0006", Severity: v1alpha1.SeverityHigh},
		{VulnerabilityID: "CVE-0000-0002", Severity: v1alpha1.SeverityMedium},
		{VulnerabilityID: "CVE-0000-0003", Severity: v1alpha1.SeverityMedium},
		{VulnerabilityID: "CVE-0000-0001", Severity: v1alpha1.SeverityLow},
	}, items)

}
